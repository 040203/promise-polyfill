(function(h){function f(a,b){return function(){a.apply(b,arguments)}}function c(a){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");if("function"!==typeof a)throw new TypeError("not a function");this._value=this._state=null;this._deferreds=[];m(a,f(n,this),f(l,this))}function p(a){var b=this;null===this._state?this._deferreds.push(a):r(function(){var e=b._state?a.onFulfilled:a.onRejected;if(null===e)(b._state?a.resolve:a.reject)(b._value);else{var d;try{d=e(b._value)}catch(c){a.reject(c);
	return}a.resolve(d)}})}function n(a){try{if(a===this)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"===typeof a||"function"===typeof a)){var b=a.then;if("function"===typeof b){m(f(b,a),f(n,this),f(l,this));return}}this._state=!0;this._value=a;q.call(this)}catch(e){l.call(this,e)}}function l(a){this._state=!1;this._value=a;q.call(this)}function q(){for(var a=0,b=this._deferreds.length;a<b;a++)p.call(this,this._deferreds[a]);this._deferreds=null}function s(a,b,e,d){this.onFulfilled=
	"function"===typeof a?a:null;this.onRejected="function"===typeof b?b:null;this.resolve=e;this.reject=d}function m(a,b,e){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,e(a))})}catch(c){d||(d=!0,e(c))}}var r=h&&h.setImmediate||function(a){setTimeout(a,0)};c.prototype["catch"]=function(a){return this.then(null,a)};c.prototype.then=function(a,b){var e=this;return new c(function(d,c){p.call(e,new s(a,b,d,c))})};c.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&Array.isArray(arguments[0])?
	arguments[0]:arguments);return new c(function(b,c){function d(g,k){try{if(k&&("object"===typeof k||"function"===typeof k)){var h=k.then;if("function"===typeof h){h.call(k,function(a){d(g,a)},c);return}}a[g]=k;0===--f&&b(a)}catch(l){c(l)}}if(0===a.length)return b([]);for(var f=a.length,g=0;g<a.length;g++)d(g,a[g])})};c.resolve=function(a){return new c(function(b){b(a)})};c.reject=function(a){return new c(function(b,c){c(a)})};c.race=function(a){return new c(function(b,c){a.map(function(a){a.then(b,
	c)})})};"undefined"!==typeof module&&module.exports?module.exports=c:h.Promise=c})(this);